## Design

### Parties

* Mobile App (MA) -- app that receives notifications
* Apple Push Notification service (APNs) -- a server controlled by Apple that delivers notifications to devices. Provides two environments: live (`gateway.push.apple.com`) and sandbox (`gateway.sandbox.push.apple.com`)
* Notification Provider (NP) -- an application that sends notifications to instances of Mobile App
* Feedback Service (FS) -- a service associated with APNs that provides status of past deliveries

### Subscription and notifications

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

MA            APNs               NP
 |--register-->|                 |
 |<----DTKN----|                 |
 |--------subscibe(DTKN)-------->|
 .             .                 .
 .             .                 .
 .             .                 .
 |             |<--notify(DTKN)--|
 |<---notify---|                 |

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

### Device Token

Token used by the notification provider is requested by Mobile App, generated by APNs and then passed by Mobile App on to the Notification Provider. Notification Provider must use it whenever it wants to notify that particular instance of Mobile App.

### Protocol

Described in [Provider Communication][PC] doc on Apple website.

The stack:

* binary protocol
* TLS/SSL
* TCP

Messages can be in simple or enhanced format.

### Feedback

Feedback service is available at `feedback.[sandbox.].push.apple.com`. When connected to it streams a list of device tokens for MAs that are no longer reachable. Apple requires that it is periodically checked and that notifications are stopped for these tokens.

### Libraries

* [JavaPNS](http://code.google.com/p/javapns/)

## Third-party providers

* [push.io](http://push.io/)

## Resources

### Apple

* [technical note](http://developer.apple.com/library/ios/#technotes/tn2265/_index.html)
* [provider communication][PC]

### JavaPNS

* [general requirements](http://code.google.com/p/javapns/wiki/GeneralRequirements)

[PC]: http://developer.apple.com/library/ios/#documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/CommunicatingWIthAPS/CommunicatingWIthAPS.html